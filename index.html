<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SRESHTA International Couriers - Admin Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #1a252f;
            --accent-color: #ff6600;
            --success-color: #27ae60;        
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --info-color: #3498db;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --text-color: #333;
            --text-light: #7f8c8d;
            --border-color: #ddd;
            --sidebar-width: 280px;
            --header-height: 70px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: #f8f9fa;
        }

        /* Login Styles */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            padding: 20px;
        }

        .login-box {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 450px;
            text-align: center;
        }

        .login-logo {
            width: 120px;
            height: 120px;
            margin: 0 auto 30px;
            background: var(--accent-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: white;
        }

        .login-title {
            font-size: 2rem;
            color: var(--dark-color);
            margin-bottom: 10px;
            font-weight: 600;
        }

        .login-subtitle {
            color: var(--text-light);
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
            position: relative;
        }

        .form-group input {
            width: 100%;
            padding: 15px 50px 15px 20px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
            background: #f8f9fa;
        }

        .form-group input:focus {
            border-color: var(--accent-color);
            outline: none;
            background: white;
            box-shadow: 0 0 0 3px rgba(255,102,0,0.1);
        }

        .form-group i {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
        }

        .login-btn {
            width: 100%;
            padding: 15px;
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .login-btn:hover {
            background: #e55a00;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255,102,0,0.3);
        }

        /* Dashboard Layout */
        .dashboard {
            display: none;
            min-height: 100vh;
        }

        .dashboard.active {
            display: block;
        }

        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-height);
            background: white;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-color);
            cursor: pointer;
            padding: 10px;
            border-radius: 5px;
            transition: background 0.3s;
        }

        .menu-toggle:hover {
            background: var(--light-color);
        }

        .header-logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 15px;
            border-radius: 25px;
            background: var(--light-color);
            cursor: pointer;
            transition: all 0.3s;
        }

        .user-menu:hover {
            background: var(--border-color);
        }

        .user-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: var(--accent-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .sidebar {
            position: fixed;
            top: var(--header-height);
            left: 0;
            width: var(--sidebar-width);
            height: calc(100vh - var(--header-height));
            background: white;
            border-right: 1px solid var(--border-color);
            padding: 20px 0;
            overflow-y: auto;
            z-index: 999;
            transition: transform 0.3s;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 5px;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 25px;
            color: var(--text-color);
            text-decoration: none;
            transition: all 0.3s;
            border-left: 3px solid transparent;
        }

        .sidebar-menu a:hover,
        .sidebar-menu a.active {
            background: rgba(255,102,0,0.1);
            border-left-color: var(--accent-color);
            color: var(--accent-color);
        }

        .sidebar-menu i {
            width: 20px;
            text-align: center;
        }

        .main-content {
            margin-left: var(--sidebar-width);
            margin-top: var(--header-height);
            padding: 30px;
            min-height: calc(100vh - var(--header-height));
        }

        /* Content Sections */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .page-header {
            display: flex;
            align-items: center;
            justify-content: between;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .page-title {
            font-size: 2rem;
            font-weight: 600;
            color: var(--dark-color);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .page-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        /* Cards */
        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            margin-bottom: 25px;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--dark-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            display: flex;
            align-items: center;
            gap: 20px;
            transition: transform 0.3s;
            border-left: 4px solid var(--accent-color);
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .stat-icon.primary { background: var(--primary-color); }
        .stat-icon.success { background: var(--success-color); }
        .stat-icon.warning { background: var(--warning-color); }
        .stat-icon.info { background: var(--info-color); }

        .stat-content h3 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
            color: var(--dark-color);
        }

        .stat-content p {
            color: var(--text-light);
            margin: 0;
        }

        /* Form Styles */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-color);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
            background: #f8f9fa;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: var(--accent-color);
            outline: none;
            background: white;
            box-shadow: 0 0 0 3px rgba(255,102,0,0.1);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: var(--accent-color);
            color: white;
        }

        .btn-primary:hover {
            background: #e55a00;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255,102,0,0.3);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background: #229954;
        }

        .btn-info {
            background: var(--info-color);
            color: white;
        }

        .btn-info:hover {
            background: #2980b9;
        }

        .btn-warning {
            background: var(--warning-color);
            color: white;
        }

        .btn-warning:hover {
            background: #d68910;
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-secondary {
            background: var(--text-light);
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6c7d;
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        .table th,
        .table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .table th {
            background: var(--light-color);
            font-weight: 600;
            color: var(--dark-color);
        }

        .table tr:hover {
            background: rgba(255,102,0,0.05);
        }

        /* Status Badges */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-created { background: #3498db; color: white; }
        .status-shipped { background: #9b59b6; color: white; }
        .status-transit { background: #f39c12; color: white; }
        .status-arrived { background: #1abc9c; color: white; }
        .status-delivery { background: #e74c3c; color: white; }
        .status-delivered { background: #27ae60; color: white; }

        /* Template Options */
        .template-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .template-option {
            padding: 15px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            background: white;
        }

        .template-option:hover {
            border-color: var(--accent-color);
            background: rgba(255,102,0,0.05);
        }

        .template-option.active {
            border-color: var(--accent-color);
            background: rgba(255,102,0,0.1);
            color: var(--accent-color);
            font-weight: 600;
        }

        .template-preview {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            min-height: 200px;
            margin-bottom: 20px;
            white-space: pre-wrap;
            font-family: inherit;
            line-height: 1.8;
            border: 1px solid var(--border-color);
        }

        /* Invoice Styles */
        .invoice-preview {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            margin-top: 20px;
        }

        .invoice-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .invoice-title {
            text-align: center;
            font-size: 2rem;
            font-weight: 700;
            margin: 30px 0;
            text-decoration: underline;
            color: var(--dark-color);
        }

        .invoice-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .invoice-table th,
        .invoice-table td {
            border: 1px solid var(--border-color);
            padding: 12px;
            text-align: left;
        }

        .invoice-table th {
            background: var(--light-color);
            font-weight: 600;
        }

        .invoice-total {
            text-align: right;
            font-weight: 600;
            margin-top: 20px;
            font-size: 1.1rem;
        }

        /* Item Management */
        .item-row {
            display: grid;
            grid-template-columns: 2fr 1fr 80px 100px 50px;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .remove-item {
            background: var(--danger-color);
            color: white;
            border: none;
            border-radius: 5px;
            width: 35px;
            height: 35px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .remove-item:hover {
            background: #c0392b;
        }

        /* Loading States */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: var(--text-light);
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0,0,0,0.1);
            border-radius: 50%;
            border-top-color: var(--accent-color);
            animation: spin 1s ease-in-out infinite;
            margin-right: 15px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Alerts */
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f1aeb5;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .alert-info {
            background: #cce7ff;
            color: #004085;
            border: 1px solid #a6d5fa;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .menu-toggle {
                display: block;
            }

            .main-content {
                margin-left: 0;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .item-row {
                grid-template-columns: 1fr;
                gap: 10px;
                padding: 15px;
                background: #f8f9fa;
                border-radius: 8px;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 20px 15px;
            }

            .page-title {
                font-size: 1.5rem;
            }

            .card {
                padding: 20px;
            }

            .template-options {
                grid-template-columns: 1fr;
            }

            .invoice-header {
                flex-direction: column;
            }

            .btn {
                padding: 10px 15px;
                font-size: 13px;
            }

            .table th,
            .table td {
                padding: 10px 8px;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 0 15px;
            }

            .header-logo {
                font-size: 1.2rem;
            }

            .login-box {
                padding: 30px 20px;
            }

            .stat-card {
                padding: 15px;
            }
        }

        /* Print Styles */
        @media print {
            .header,
            .sidebar,
            .page-actions,
            .btn,
            .form-section {
                display: none !important;
            }

            .main-content {
                margin: 0;
                padding: 0;
            }

            .invoice-preview {
                box-shadow: none;
                border: none;
            }
        }

        /* Dark Mode Support */
        @media (prefers-color-scheme: dark) {
            :root {
                --text-color: #e1e1e1;
                --text-light: #b0b0b0;
                --border-color: #404040;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="login-box">
            <div class="login-logo">
                <i class="fas fa-shipping-fast"></i>
            </div>
            <h1 class="login-title">Welcome Back</h1>
            <p class="login-subtitle">SRESHTA International Couriers Admin</p>
            <form id="loginForm">
                <div class="form-group">
                    <input type="email" id="email" placeholder="Enter your email" required>
                    <i class="fas fa-envelope"></i>
                </div>
                <div class="form-group">
                    <input type="password" id="password" placeholder="Enter your password" required>
                    <i class="fas fa-lock"></i>
                </div>
                <button type="submit" class="login-btn">
                    <i class="fas fa-sign-in-alt"></i>
                    Sign In
                </button>
            </form>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="dashboard">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <button class="menu-toggle" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="header-logo">
                    <i class="fas fa-shipping-fast"></i>
                    SRESHTA Admin
                </div>
            </div>
            <div class="header-right">
                <div class="user-menu" onclick="logout()">
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <span id="userEmail">admin@sreshta.com</span>
                    <i class="fas fa-sign-out-alt"></i>
                </div>
            </div>
        </header>

        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            <ul class="sidebar-menu">
                <li><a href="#" onclick="showSection('dashboard')" class="active">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a></li>
                <li><a href="#" onclick="showSection('shipments')">
                    <i class="fas fa-box"></i> Manage Shipments
                </a></li>
                <li><a href="#" onclick="showSection('create-link')">
                    <i class="fas fa-link"></i> Create Tracking Link
                </a></li>
                <li><a href="#" onclick="showSection('invoice')">
                    <i class="fas fa-file-invoice"></i> Invoice Generator
                </a></li>
                <li><a href="#" onclick="showSection('customers')">
                    <i class="fas fa-users"></i> Customers
                </a></li>
                <li><a href="#" onclick="showSection('reports')">
                    <i class="fas fa-chart-bar"></i> Reports
                </a></li>
                <li><a href="#" onclick="showSection('settings')">
                    <i class="fas fa-cog"></i> Settings
                </a></li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Section -->
            <section id="dashboard-section" class="content-section active">
                <div class="page-header">
                    <h1 class="page-title">
                        <i class="fas fa-tachometer-alt"></i>
                        Dashboard Overview
                    </h1>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon primary">
                            <i class="fas fa-box"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="totalShipments">1,234</h3>
                            <p>Total Shipments</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon success">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="deliveredShipments">987</h3>
                            <p>Delivered</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon warning">
                            <i class="fas fa-truck"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="inTransitShipments">156</h3>
                            <p>In Transit</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon info">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="pendingShipments">91</h3>
                            <p>Pending</p>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-chart-line"></i>
                            Recent Activity
                        </h2>
                    </div>
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Tracking ID</th>
                                    <th>Customer</th>
                                    <th>Status</th>
                                    <th>Destination</th>
                                    <th>Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="recentActivity">
                                <tr>
                                    <td>SIC00000001</td>
                                    <td>John Doe</td>
                                    <td><span class="status-badge status-delivered"><i class="fas fa-check"></i> Delivered</span></td>
                                    <td>New York, USA</td>
                                    <td>2025-01-01</td>
                                    <td>
                                        <button class="btn btn-info btn-sm" style="padding: 5px 10px; font-size: 12px;">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>SIC00000002</td>
                                    <td>Jane Smith</td>
                                    <td><span class="status-badge status-transit"><i class="fas fa-truck"></i> In Transit</span></td>
                                    <td>London, UK</td>
                                    <td>2025-01-02</td>
                                    <td>
                                        <button class="btn btn-info btn-sm" style="padding: 5px 10px; font-size: 12px;">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Shipments Section -->
            <section id="shipments-section" class="content-section">
                <div class="page-header">
                    <h1 class="page-title">
                        <i class="fas fa-box"></i>
                        Manage Shipments
                    </h1>
                    <div class="page-actions">
                        <button class="btn btn-primary" onclick="showCreateShipmentForm()">
                            <i class="fas fa-plus"></i> New Shipment
                        </button>
                    </div>
                </div>

                <!-- Create/Edit Shipment Form -->
                <div id="shipmentForm" class="card" style="display: none;">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-plus-circle"></i>
                            <span id="formTitle">Create New Shipment</span>
                        </h2>
                        <button class="btn btn-secondary" onclick="hideShipmentForm()">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                    <form id="createShipmentForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="trackingNumber"><i class="fas fa-barcode"></i> Tracking Number</label>
                                <input type="text" id="trackingNumber" placeholder="SIC00000001" required>
                            </div>
                            <div class="form-group">
                                <label for="customerName"><i class="fas fa-user"></i> Customer Name</label>
                                <input type="text" id="customerName" placeholder="Enter customer name" required>
                            </div>
                            <div class="form-group">
                                <label for="customerEmail"><i class="fas fa-envelope"></i> Customer Email</label>
                                <input type="email" id="customerEmailInput" placeholder="customer@email.com">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="origin"><i class="fas fa-map-marker-alt"></i> Origin</label>
                                <input type="text" id="origin" placeholder="Guntur, India" required>
                            </div>
                            <div class="form-group">
                                <label for="destination"><i class="fas fa-map-marker-alt"></i> Destination</label>
                                <input type="text" id="destination" placeholder="New York, USA" required>
                            </div>
                            <div class="form-group">
                                <label for="weight"><i class="fas fa-weight"></i> Weight (kg)</label>
                                <input type="number" id="weight" placeholder="0.5" step="0.1" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="status"><i class="fas fa-info-circle"></i> Status</label>
                                <select id="status" required>
                                    <option value="Shipment Created">Shipment Created</option>
                                    <option value="Shipped from India">Shipped from India</option>
                                    <option value="In Transit">In Transit</option>
                                    <option value="Reached Destination Country">Reached Destination Country</option>
                                    <option value="In Local Facility">In Local Facility</option>
                                    <option value="Out for Delivery">Out for Delivery</option>
                                    <option value="Delivered">Delivered</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="awbNumber"><i class="fas fa-file-alt"></i> Forwarding AWB</label>
                                <input type="text" id="awbNumber" placeholder="External courier AWB number">
                            </div>
                            <div class="form-group">
                                <label for="forwardingCourier"><i class="fas fa-truck"></i> Forwarding Courier</label>
                                <input type="text" id="forwardingCourier" placeholder="FedEx, DHL, etc.">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="notes"><i class="fas fa-sticky-note"></i> Notes</label>
                                <textarea id="notes" placeholder="Additional notes or comments"></textarea>
                            </div>
                        </div>
                        <div class="form-row">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Save Shipment
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Shipments List -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-list"></i>
                            All Shipments
                        </h2>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="searchShipments" placeholder="Search shipments..." style="padding: 8px 12px; border: 1px solid var(--border-color); border-radius: 5px;">
                            <button class="btn btn-info" onclick="refreshShipments()">
                                <i class="fas fa-refresh"></i> Refresh
                            </button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Tracking ID</th>
                                    <th>Customer</th>
                                    <th>Origin → Destination</th>
                                    <th>Status</th>
                                    <th>Weight</th>
                                    <th>Created</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="shipmentsTable">
                                <tr>
                                    <td colspan="7" class="loading">
                                        <div class="spinner"></div>
                                        Loading shipments...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Create Tracking Link Section -->
            <section id="create-link-section" class="content-section">
                <div class="page-header">
                    <h1 class="page-title">
                        <i class="fas fa-link"></i>
                        Create Tracking Link
                    </h1>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-plus-circle"></i>
                            Generate Tracking Link
                        </h2>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="linkTrackingNumber"><i class="fas fa-barcode"></i> Tracking Number</label>
                            <input type="text" id="linkTrackingNumber" placeholder="SIC00000001">
                        </div>
                        <div class="form-group">
                            <label for="linkCountryCode"><i class="fas fa-globe"></i> Country Code</label>
                            <select id="linkCountryCode">
                                <option value="91">India (+91)</option>
                                <option value="1">USA (+1)</option>
                                <option value="44">UK (+44)</option>
                                <option value="971">UAE (+971)</option>
                                <option value="966">KSA (+966)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="linkPhoneNumber"><i class="fas fa-mobile-alt"></i> Phone Number</label>
                            <input type="tel" id="linkPhoneNumber" placeholder="9876543210">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="linkCustomerEmail"><i class="fas fa-envelope"></i> Customer Email</label>
                            <input type="email" id="linkCustomerEmail" placeholder="customer@email.com">
                        </div>
                        <div class="form-group">
                            <label for="linkDeliveryDate"><i class="fas fa-calendar"></i> Estimated Delivery Date</label>
                            <input type="date" id="linkDeliveryDate">
                        </div>
                        <div class="form-group">
                            <label for="linkDeliveryTime"><i class="fas fa-clock"></i> Estimated Time</label>
                            <input type="time" id="linkDeliveryTime" value="12:00">
                        </div>
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-info-circle"></i> Package Status</label>
                        <div class="template-options">
                            <div class="template-option active" data-status="processing" onclick="selectLinkStatus('processing')">
                                <i class="fas fa-cog"></i> Processing
                            </div>
                            <div class="template-option" data-status="shipped" onclick="selectLinkStatus('shipped')">
                                <i class="fas fa-shipping-fast"></i> Shipped
                            </div>
                            <div class="template-option" data-status="transit" onclick="selectLinkStatus('transit')">
                                <i class="fas fa-truck"></i> In Transit
                            </div>
                            <div class="template-option" data-status="delivered" onclick="selectLinkStatus('delivered')">
                                <i class="fas fa-check-circle"></i> Delivered
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-envelope"></i> Message Template</label>
                        <div class="template-options">
                            <div class="template-option active" data-template="plain" onclick="selectLinkTemplate('plain')">
                                <i class="fas fa-align-left"></i> Plain Text
                            </div>
                            <div class="template-option" data-template="symbols" onclick="selectLinkTemplate('symbols')">
                                <i class="fas fa-icons"></i> With Symbols
                            </div>
                            <div class="template-option" data-template="pro" onclick="selectLinkTemplate('pro')">
                                <i class="fas fa-file-alt"></i> Professional
                            </div>
                            <div class="template-option" data-template="premium" onclick="selectLinkTemplate('premium')">
                                <i class="fas fa-star"></i> Premium
                            </div>
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="generateTrackingLink()">
                        <i class="fas fa-plus-circle"></i> Generate Link
                    </button>
                </div>

                <div id="linkResult" class="card" style="display: none;">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-link"></i>
                            Your Tracking Link
                        </h2>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-link"></i> Generated Link</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="generatedTrackingLink" readonly>
                            <button class="btn btn-secondary" onclick="copyTrackingLink()">
                                <i class="fas fa-copy"></i> Copy
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-eye"></i> Message Preview</label>
                        <div class="template-preview" id="linkTemplatePreview">
                            Generate link to see preview
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn btn-success" onclick="sendLinkWhatsApp()">
                            <i class="fab fa-whatsapp"></i> WhatsApp
                        </button>
                        <button class="btn btn-info" onclick="sendLinkSMS()">
                            <i class="fas fa-sms"></i> SMS
                        </button>
                        <button class="btn btn-warning" onclick="sendLinkEmail()">
                            <i class="fas fa-envelope"></i> Email
                        </button>
                        <button class="btn btn-secondary" onclick="copyLinkMessage()">
                            <i class="fas fa-copy"></i> Copy Text
                        </button>
                    </div>
                </div>
            </section>

            <!-- Invoice Generator Section -->
            <section id="invoice-section" class="content-section">
                <div class="page-header">
                    <h1 class="page-title">
                        <i class="fas fa-file-invoice"></i>
                        Invoice Generator
                    </h1>
                    <div class="page-actions">
                        <button class="btn btn-success" onclick="printInvoice()">
                            <i class="fas fa-print"></i> Print Invoice
                        </button>
                        <button class="btn btn-info" onclick="downloadInvoice()">
                            <i class="fas fa-download"></i> Download PDF
                        </button>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                    <!-- Invoice Form -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-edit"></i>
                                Invoice Details
                            </h2>
                        </div>
                        
                        <div class="form-group">
                            <label for="invoiceNumber"><i class="fas fa-hashtag"></i> Invoice Number</label>
                            <input type="text" id="invoiceNumber" value="INV-001">
                        </div>
                        
                        <div class="form-group">
                            <label for="invoiceDate"><i class="fas fa-calendar"></i> Date</label>
                            <input type="date" id="invoiceDate">
                        </div>
                        
                        <h3 style="margin: 20px 0 15px 0; color: var(--dark-color); display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-user-tie"></i> From (Shipper)
                        </h3>
                        <div class="form-group">
                            <label for="shipperName"><i class="fas fa-user"></i> Name</label>
                            <input type="text" id="shipperName" value="TUMMALA SANTOSH KUMAR">
                        </div>
                        <div class="form-group">
                            <label for="shipperAddress"><i class="fas fa-map-marker-alt"></i> Address</label>
                            <textarea id="shipperAddress"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="shipperID"><i class="fas fa-id-card"></i> Aadhaar Number</label>
                            <input type="text" id="shipperID" value="648249731918">
                        </div>
                        
                        <h3 style="margin: 20px 0 15px 0; color: var(--dark-color); display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-user"></i> To (Consignee)
                        </h3>
                        <div class="form-group">
                            <label for="consigneeName"><i class="fas fa-user"></i> Name</label>
                            <input type="text" id="consigneeName" value="KIRAN GOLLAMUDI">
                        </div>
                        <div class="form-group">
                            <label for="consigneeAddress"><i class="fas fa-map-marker-alt"></i> Address</label>
                            <textarea id="consigneeAddress">56 MEYER RD 4643, EDISON, NJ, U.S.A.</textarea>
                        </div>
                        <div class="form-group">
                            <label for="consigneePhone"><i class="fas fa-phone"></i> Phone</label>
                            <input type="text" id="consigneePhone" value="8143888039">
                        </div>
                        
                        <h3 style="margin: 20px 0 15px 0; color: var(--dark-color); display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-shipping-fast"></i> Shipping Details
                        </h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="deliveryTerms"><i class="fas fa-handshake"></i> Terms of Delivery</label>
                                <input type="text" id="deliveryTerms" value="UNSOLICITED GIFT - NOT FOR SALE">
                            </div>
                            <div class="form-group">
                                <label for="originCountry"><i class="fas fa-flag"></i> Country of Origin</label>
                                <input type="text" id="originCountry" value="INDIA">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="destinationCountry"><i class="fas fa-flag"></i> Country of Destination</label>
                                <input type="text" id="destinationCountry" value="U.S.A.">
                            </div>
                            <div class="form-group">
                                <label for="shippingMethod"><i class="fas fa-truck"></i> Pre-carriage By</label>
                                <input type="text" id="shippingMethod" value="PKT">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="invoiceWeight"><i class="fas fa-weight"></i> Weight</label>
                            <input type="text" id="invoiceWeight" value="3 BOX">
                        </div>
                        
                        <h3 style="margin: 20px 0 15px 0; color: var(--dark-color); display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-list"></i> Items
                        </h3>
                        <div id="invoiceItemsContainer">
                            <div class="item-row">
                                <input type="text" class="item-desc" placeholder="Description" value="HOME MADE PICKLE MADE FROM MIXED VEGETABLE AND FRUITS, CHILLIPOWDER, VARIOUS INDIAN SPICES AND EDIBLE OIL">
                                <input type="text" class="item-hscode" placeholder="HS Code" value="20019000">
                                <input type="number" class="item-qty" placeholder="Qty" value="2" step="0.001">
                                <input type="number" class="item-rate" placeholder="Rate" value="750" step="0.01">
                                <button type="button" class="remove-item" onclick="removeInvoiceItem(this)">×</button>
                            </div>
                            <div class="item-row">
                                <input type="text" class="item-desc" placeholder="Description" value="HOME MADE SWEET MADE FROM GRAM FLOUR, ALL PURPOSE FLOUR, SUGAR, USED SPICES FOR FLAVOUR AND SUGAR SYRUP">
                                <input type="text" class="item-hscode" placeholder="HS Code" value="17049020">
                                <input type="number" class="item-qty" placeholder="Qty" value="1.5" step="0.001">
                                <input type="number" class="item-rate" placeholder="Rate" value="650" step="0.01">
                                <button type="button" class="remove-item" onclick="removeInvoiceItem(this)">×</button>
                            </div>
                        </div>
                        <button type="button" class="btn btn-secondary" onclick="addInvoiceItem()">
                            <i class="fas fa-plus"></i> Add Item
                        </button>
                        
                        <button type="button" class="btn btn-primary" onclick="generateInvoice()" style="margin-top: 20px;">
                            <i class="fas fa-file-invoice"></i> Generate Invoice
                        </button>
                    </div>

                    <!-- Invoice Preview -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-eye"></i>
                                Invoice Preview
                            </h2>
                        </div>
                        <div id="invoicePreview" class="invoice-preview">
                            <div style="text-align: center; color: var(--text-light); padding: 40px;">
                                <i class="fas fa-file-invoice" style="font-size: 3rem; margin-bottom: 20px;"></i>
                                <p>Click "Generate Invoice" to see preview</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Customers Section -->
            <section id="customers-section" class="content-section">
                <div class="page-header">
                    <h1 class="page-title">
                        <i class="fas fa-users"></i>
                        Customers
                    </h1>
                    <div class="page-actions">
                        <button class="btn btn-primary">
                            <i class="fas fa-plus"></i> Add Customer
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-list"></i>
                            Customer List
                        </h2>
                    </div>
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Total Shipments</th>
                                    <th>Last Order</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>John Doe</td>
                                    <td>john@example.com</td>
                                    <td>+1 234 567 8900</td>
                                    <td>15</td>
                                    <td>2025-01-01</td>
                                    <td>
                                        <button class="btn btn-info btn-sm" style="padding: 5px 10px; font-size: 12px;">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-warning btn-sm" style="padding: 5px 10px; font-size: 12px;">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Jane Smith</td>
                                    <td>jane@example.com</td>
                                    <td>+44 123 456 789</td>
                                    <td>8</td>
                                    <td>2025-01-02</td>
                                    <td>
                                        <button class="btn btn-info btn-sm" style="padding: 5px 10px; font-size: 12px;">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-warning btn-sm" style="padding: 5px 10px; font-size: 12px;">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Reports Section -->
            <section id="reports-section" class="content-section">
                <div class="page-header">
                    <h1 class="page-title">
                        <i class="fas fa-chart-bar"></i>
                        Reports & Analytics
                    </h1>
                    <div class="page-actions">
                        <button class="btn btn-primary">
                            <i class="fas fa-download"></i> Export Report
                        </button>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon success">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="stat-content">
                            <h3>₹2,45,680</h3>
                            <p>Monthly Revenue</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon info">
                            <i class="fas fa-percentage"></i>
                        </div>
                        <div class="stat-content">
                            <h3>98.5%</h3>
                            <p>Delivery Success Rate</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon warning">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-content">
                            <h3>3.2 days</h3>
                            <p>Average Delivery Time</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon primary">
                            <i class="fas fa-heart"></i>
                        </div>
                        <div class="stat-content">
                            <h3>4.8/5</h3>
                            <p>Customer Satisfaction</p>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-chart-line"></i>
                            Monthly Performance
                        </h2>
                    </div>
                    <div style="padding: 40px; text-align: center; color: var(--text-light);">
                        <i class="fas fa-chart-bar" style="font-size: 3rem; margin-bottom: 20px;"></i>
                        <p>Chart visualization would go here</p>
                    </div>
                </div>
            </section>

            <!-- Settings Section -->
            <section id="settings-section" class="content-section">
                <div class="page-header">
                    <h1 class="page-title">
                        <i class="fas fa-cog"></i>
                        Settings
                    </h1>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-user-cog"></i>
                            Account Settings
                        </h2>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="settingsEmail"><i class="fas fa-envelope"></i> Email</label>
                            <input type="email" id="settingsEmail" value="admin@sreshta.com">
                        </div>
                        <div class="form-group">
                            <label for="settingsPassword"><i class="fas fa-lock"></i> New Password</label>
                            <input type="password" id="settingsPassword" placeholder="Enter new password">
                        </div>
                    </div>
                    <button class="btn btn-primary">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-building"></i>
                            Company Information
                        </h2>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="companyName"><i class="fas fa-building"></i> Company Name</label>
                            <input type="text" id="companyName" value="SRESHTA International Couriers">
                        </div>
                        <div class="form-group">
                            <label for="companyPhone"><i class="fas fa-phone"></i> Phone</label>
                            <input type="text" id="companyPhone" value="+91 94939 24742">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="companyAddress"><i class="fas fa-map-marker-alt"></i> Address</label>
                        <textarea id="companyAddress">7/4, Sali Pet, Arundelpet, Guntur, Andhra Pradesh 522002</textarea>
                    </div>
                    <button class="btn btn-primary">
                        <i class="fas fa-save"></i> Update Information
                    </button>
                </div>
            </section>
        </main>
    </div>

    <script type="module">
        // Firebase Configuration
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, deleteDoc, collection, getDocs, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAIMQbZZjIb-Z_sNJ4_7XhNz0DtiNnSSfg",
            authDomain: "shipment-bec8d.firebaseapp.com",
            projectId: "shipment-bec8d",
            storageBucket: "shipment-bec8d.appspot.com",
            messagingSenderId: "83538524138",
            appId: "1:83538524138:web:c06cf1b00915ea1f606493",
            measurementId: "G-XHDE3ZMCEY"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Global Variables
        let currentSection = 'dashboard';
        let selectedLinkTemplate = 'plain';
        let selectedLinkStatus = 'processing';
        let currentTrackingLink = '';
        let currentTrackingNumber = '';
        let editingShipment = null;

        // Valid login credentials
        const validCredentials = [
            { email: 'admin@sreshta.com', password: 'admin123' },
            { email: 'manager@sreshta.com', password: 'manager123' },
            { email: 'staff@sreshta.com', password: 'staff123' },
            { email: 'support@sreshta.com', password: 'support123' },
            { email: 'owner@sreshta.com', password: 'owner123' }
        ];

        // Set default dates
        document.getElementById('invoiceDate').valueAsDate = new Date();
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        document.getElementById('linkDeliveryDate').valueAsDate = tomorrow;

        // Authentication
        function checkAuth() {
            const isLoggedIn = localStorage.getItem('sreshta_logged_in');
            if (isLoggedIn === 'true') {
                showDashboard();
                const userEmail = localStorage.getItem('sreshta_user_email');
                if (userEmail) {
                    document.getElementById('userEmail').textContent = userEmail;
                }
            } else {
                showLogin();
            }
        }

        function showLogin() {
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('dashboard').classList.remove('active');
        }

        function showDashboard() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('dashboard').classList.add('active');
            loadDashboardData();
        }

        // Login Form Handler
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            const validUser = validCredentials.find(cred => 
                cred.email === email && cred.password === password
            );

            if (validUser) {
                localStorage.setItem('sreshta_logged_in', 'true');
                localStorage.setItem('sreshta_user_email', email);
                showDashboard();
                showAlert('Login successful!', 'success');
            } else {
                showAlert('Invalid email or password!', 'error');
            }
        });

        // Logout Function
        window.logout = function() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('sreshta_logged_in');
                localStorage.removeItem('sreshta_user_email');
                showLogin();
            }
        };

        // Navigation Functions
        window.showSection = function(section) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.sidebar-menu a').forEach(a => a.classList.remove('active'));
            
            // Show selected section
            document.getElementById(section + '-section').classList.add('active');
            document.querySelector(`[onclick="showSection('${section}')"]`).classList.add('active');
            
            currentSection = section;
            
            // Load section-specific data
            if (section === 'shipments') {
                loadShipments();
            }
        };

        window.toggleSidebar = function() {
            document.getElementById('sidebar').classList.toggle('open');
        };

        // Alert Function
        function showAlert(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                ${message}
            `;
            
            const container = document.querySelector('.main-content');
            container.insertBefore(alertDiv, container.firstChild);
            
            setTimeout(() => alertDiv.remove(), 5000);
        }

        // Dashboard Data Loading
        async function loadDashboardData() {
            try {
                const shipmentsRef = collection(db, 'shipments');
                const snapshot = await getDocs(shipmentsRef);
                
                let totalShipments = 0;
                let deliveredShipments = 0;
                let inTransitShipments = 0;
                let pendingShipments = 0;
                
                snapshot.forEach(doc => {
                    totalShipments++;
                    const status = doc.data().status;
                    if (status === 'Delivered') deliveredShipments++;
                    else if (status === 'In Transit') inTransitShipments++;
                    else pendingShipments++;
                });
                
                document.getElementById('totalShipments').textContent = totalShipments;
                document.getElementById('deliveredShipments').textContent = deliveredShipments;
                document.getElementById('inTransitShipments').textContent = inTransitShipments;
                document.getElementById('pendingShipments').textContent = pendingShipments;
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }

        // Shipment Management
        window.showCreateShipmentForm = function() {
            document.getElementById('shipmentForm').style.display = 'block';
            document.getElementById('trackingNumber').value = generateTrackingNumber();
            editingShipment = null;
            document.getElementById('formTitle').textContent = 'Create New Shipment';
        };

        window.hideShipmentForm = function() {
            document.getElementById('shipmentForm').style.display = 'none';
            document.getElementById('createShipmentForm').reset();
            editingShipment = null;
        };

        function generateTrackingNumber() {
            const timestamp = Date.now().toString().slice(-8);
            return `SIC${timestamp}`;
        }

        // Create Shipment Form Handler
        document.getElementById('createShipmentForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const shipmentData = {
                trackingNumber: document.getElementById('trackingNumber').value,
                customerName: document.getElementById('customerName').value,
                customerEmail: document.getElementById('customerEmailInput').value,
                origin: document.getElementById('origin').value,
                destination: document.getElementById('destination').value,
                weight: parseFloat(document.getElementById('weight').value),
                status: document.getElementById('status').value,
                awbNumber: document.getElementById('awbNumber').value,
                forwardingCourier: document.getElementById('forwardingCourier').value,
                notes: document.getElementById('notes').value,
                createdAt: new Date(),
                updatedAt: new Date()
            };

            try {
                if (editingShipment) {
                    await updateDoc(doc(db, 'shipments', editingShipment), shipmentData);
                    showAlert('Shipment updated successfully!', 'success');
                } else {
                    await setDoc(doc(db, 'shipments', shipmentData.trackingNumber), shipmentData);
                    showAlert('Shipment created successfully!', 'success');
                }
                
                hideShipmentForm();
                loadShipments();
                loadDashboardData();
            } catch (error) {
                console.error('Error saving shipment:', error);
                showAlert('Error saving shipment!', 'error');
            }
        });

        // Load Shipments
        async function loadShipments() {
            const tableBody = document.getElementById('shipmentsTable');
            tableBody.innerHTML = '<tr><td colspan="7" class="loading"><div class="spinner"></div>Loading shipments...</td></tr>';
            
            try {
                const shipmentsRef = collection(db, 'shipments');
                const q = query(shipmentsRef, orderBy('createdAt', 'desc'));
                const snapshot = await getDocs(q);
                
                if (snapshot.empty) {
                    tableBody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px; color: var(--text-light);">No shipments found</td></tr>';
                    return;
                }
                
                let html = '';
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const createdDate = data.createdAt?.toDate ? data.createdAt.toDate().toLocaleDateString() : 'N/A';
                    const statusClass = getStatusClass(data.status);
                    
                    html += `
                        <tr>
                            <td><strong>${data.trackingNumber}</strong></td>
                            <td>${data.customerName}</td>
                            <td>${data.origin} → ${data.destination}</td>
                            <td><span class="status-badge ${statusClass}"><i class="fas fa-circle"></i> ${data.status}</span></td>
                            <td>${data.weight} kg</td>
                            <td>${createdDate}</td>
                            <td>
                                <button class="btn btn-info btn-sm" onclick="viewShipment('${doc.id}')" style="padding: 5px 10px; font-size: 12px;">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-warning btn-sm" onclick="editShipment('${doc.id}')" style="padding: 5px 10px; font-size: 12px;">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-danger btn-sm" onclick="deleteShipment('${doc.id}')" style="padding: 5px 10px; font-size: 12px;">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                });
                
                tableBody.innerHTML = html;
            } catch (error) {
                console.error('Error loading shipments:', error);
                tableBody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px; color: var(--danger-color);">Error loading shipments</td></tr>';
            }
        }

        function getStatusClass(status) {
            const statusClasses = {
                'Shipment Created': 'status-created',
                'Shipped from India': 'status-shipped',
                'In Transit': 'status-transit',
                'Reached Destination Country': 'status-arrived',
                'In Local Facility': 'status-arrived',
                'Out for Delivery': 'status-delivery',
                'Delivered': 'status-delivered'
            };
            return statusClasses[status] || 'status-created';
        }

        window.viewShipment = function(id) {
            // Implement view shipment details
            showAlert(`Viewing shipment: ${id}`, 'info');
        };

        window.editShipment = async function(id) {
            try {
                const docRef = doc(db, 'shipments', id);
                const docSnap = await getDoc(docRef);
                
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    editingShipment = id;
                    
                    // Populate form with existing data
                    document.getElementById('trackingNumber').value = data.trackingNumber;
                    document.getElementById('customerName').value = data.customerName;
                    document.getElementById('customerEmailInput').value = data.customerEmail || '';
                    document.getElementById('origin').value = data.origin;
                    document.getElementById('destination').value = data.destination;
                    document.getElementById('weight').value = data.weight;
                    document.getElementById('status').value = data.status;
                    document.getElementById('awbNumber').value = data.awbNumber || '';
                    document.getElementById('forwardingCourier').value = data.forwardingCourier || '';
                    document.getElementById('notes').value = data.notes || '';
                    
                    document.getElementById('formTitle').textContent = 'Edit Shipment';
                    document.getElementById('shipmentForm').style.display = 'block';
                }
            } catch (error) {
                console.error('Error loading shipment for edit:', error);
                showAlert('Error loading shipment data!', 'error');
            }
        };

        window.deleteShipment = async function(id) {
            if (confirm('Are you sure you want to delete this shipment?')) {
                try {
                    await deleteDoc(doc(db, 'shipments', id));
                    showAlert('Shipment deleted successfully!', 'success');
                    loadShipments();
                    loadDashboardData();
                } catch (error) {
                    console.error('Error deleting shipment:', error);
                    showAlert('Error deleting shipment!', 'error');
                }
            }
        };

        window.refreshShipments = function() {
            loadShipments();
        };

        // Tracking Link Generator
        window.selectLinkStatus = function(status) {
            selectedLinkStatus = status;
            document.querySelectorAll('.template-option[data-status]').forEach(opt => {
                opt.classList.remove('active');
            });
            document.querySelector(`.template-option[data-status="${status}"]`).classList.add('active');
            
            if (currentTrackingLink) {
                updateLinkTemplatePreview();
            }
        };

        window.selectLinkTemplate = function(template) {
            selectedLinkTemplate = template;
            document.querySelectorAll('.template-option[data-template]').forEach(opt => {
                opt.classList.remove('active');
            });
            document.querySelector(`.template-option[data-template="${template}"]`).classList.add('active');
            
            if (currentTrackingLink) {
                updateLinkTemplatePreview();
            }
        };

        window.generateTrackingLink = function() {
            const trackingNumber = document.getElementById('linkTrackingNumber').value.trim();
            if (!trackingNumber) {
                showAlert('Please enter a tracking number', 'warning');
                return;
            }
            
            const baseUrl = window.location.origin;
            currentTrackingLink = `${baseUrl}/?ref=${encodeURIComponent(trackingNumber)}`;
            currentTrackingNumber = trackingNumber;
            
            document.getElementById('generatedTrackingLink').value = currentTrackingLink;
            updateLinkTemplatePreview();
            document.getElementById('linkResult').style.display = 'block';
            
            showAlert('Tracking link generated successfully!', 'success');
        };

        function updateLinkTemplatePreview() {
            const deliveryDate = formatLinkDeliveryDate();
            const status = getLinkStatusDetails();
            
            let templateContent = '';
            
            switch(selectedLinkTemplate) {
                case 'plain':
                    templateContent = `SRESHTA INTERNATIONAL COURIERS
Tracking Notification

Tracking Number: ${currentTrackingNumber}
Status: ${status.text}
${deliveryDate ? `Estimated Delivery: ${deliveryDate}` : ''}

Track your package at: ${currentTrackingLink}

Thank you for choosing SRESHTA International Couriers`;
                    break;
                    
                case 'symbols':
                    templateContent = `📦 SRESHTA INTERNATIONAL COURIERS 📦

🔍 Tracking Number: ${currentTrackingNumber}
${status.icon} Status: ${status.text}
${deliveryDate ? `📅 Estimated Delivery: ${deliveryDate}` : ''}
ℹ️ ${status.description}

👉 Track here: ${currentTrackingLink}

✨ Thank you for your business!`;
                    break;
                    
                case 'pro':
                    templateContent = `Dear Valued Customer,

Your SRESHTA shipment (${currentTrackingNumber}) is now active in our system.

Current Status: ${status.text}
${deliveryDate ? `Estimated Delivery: ${deliveryDate}` : ''}
Details: ${status.description}

Track your package:
${currentTrackingLink}

For assistance, contact:
📞 Phone: +91 94939 24742
✉️ Email: support@sreshtacouriers.com

Sincerely,
SRESHTA International Couriers Team`;
                    break;
                    
                case 'premium':
                    templateContent = `🌟 SRESHTA INTERNATIONAL COURIERS 🌟
                    
Dear Customer,

We're pleased to inform you about your shipment details:

🔹 Tracking Number: ${currentTrackingNumber}
🔹 Current Status: ${status.text}
${deliveryDate ? `🔹 Estimated Delivery: ${deliveryDate}` : ''}
🔹 Status Details: ${status.description}

📌 Important Information:
• Please have your ID ready for delivery
• Track your package anytime: ${currentTrackingLink}

Need help? Our customer service team is available:
☎️ +91 94939 24742 (9AM-6PM)
📧 support@sreshtacouriers.com

Thank you for trusting us with your delivery needs.

Best regards,
The SRESHTA Team
🏆 Premium International Courier Services`;
                    break;
            }
            
            document.getElementById('linkTemplatePreview').textContent = templateContent;
        }

        function formatLinkDeliveryDate() {
            const date = document.getElementById('linkDeliveryDate').value;
            const time = document.getElementById('linkDeliveryTime').value;
            
            if (!date) return '';
            
            const deliveryDate = new Date(`${date}T${time}`);
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            
            return deliveryDate.toLocaleDateString('en-US', options);
        }

        function getLinkStatusDetails() {
            const statusDetails = {
                processing: {
                    icon: '⏳',
                    text: 'Processing',
                    description: 'Your package is being prepared for shipment'
                },
                shipped: {
                    icon: '🚚',
                    text: 'Shipped',
                    description: 'Your package has left our facility'
                },
                transit: {
                    icon: '✈️',
                    text: 'In Transit',
                    description: 'Your package is on its way'
                },
                delivered: {
                    icon: '✅',
                    text: 'Delivered',
                    description: 'Your package has been delivered'
                }
            };
            
            return statusDetails[selectedLinkStatus] || statusDetails.processing;
        }

        window.copyTrackingLink = function() {
            const linkInput = document.getElementById('generatedTrackingLink');
            linkInput.select();
            document.execCommand('copy');
            showAlert('Tracking link copied to clipboard!', 'success');
        };

        window.copyLinkMessage = function() {
            const messageText = document.getElementById('linkTemplatePreview').textContent;
            navigator.clipboard.writeText(messageText)
                .then(() => showAlert('Message copied to clipboard!', 'success'))
                .catch(err => {
                    console.error('Failed to copy:', err);
                    showAlert('Failed to copy message!', 'error');
                });
        };

        window.sendLinkWhatsApp = function() {
            const phoneNumber = document.getElementById('linkPhoneNumber').value.trim();
            const countryCode = document.getElementById('linkCountryCode').value;
            
            if (!phoneNumber) {
                showAlert('Please enter a phone number', 'warning');
                return;
            }
            
            const messageText = document.getElementById('linkTemplatePreview').textContent;
            const whatsappUrl = `https://wa.me/${countryCode}${phoneNumber}?text=${encodeURIComponent(messageText)}`;
            window.open(whatsappUrl, '_blank');
        };

        window.sendLinkSMS = function() {
            const phoneNumber = document.getElementById('linkPhoneNumber').value.trim();
            const countryCode = document.getElementById('linkCountryCode').value;
            
            if (!phoneNumber) {
                showAlert('Please enter a phone number', 'warning');
                return;
            }
            
            const messageText = document.getElementById('linkTemplatePreview').textContent;
            const smsUrl = `sms:${countryCode}${phoneNumber}?body=${encodeURIComponent(messageText)}`;
            window.location.href = smsUrl;
        };

        window.sendLinkEmail = function() {
            const email = document.getElementById('linkCustomerEmail').value.trim();
            
            if (!email) {
                showAlert('Please enter an email address', 'warning');
                return;
            }
            
            const messageText = document.getElementById('linkTemplatePreview').textContent;
            const subject = `Your Sreshta Package Tracking (${currentTrackingNumber})`;
            const emailUrl = `mailto:${email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(messageText)}`;
            window.location.href = emailUrl;
        };

        // Invoice Generator Functions
        window.addInvoiceItem = function() {
            const container = document.getElementById('invoiceItemsContainer');
            const itemRow = document.createElement('div');
            itemRow.className = 'item-row';
            itemRow.innerHTML = `
                <input type="text" class="item-desc" placeholder="Description">
                <input type="text" class="item-hscode" placeholder="HS Code">
                <input type="number" class="item-qty" placeholder="Qty" value="1" step="0.001">
                <input type="number" class="item-rate" placeholder="Rate" value="0" step="0.01">
                <button type="button" class="remove-item" onclick="removeInvoiceItem(this)">×</button>
            `;
            container.appendChild(itemRow);
            
            // Add event listeners to new inputs
            const inputs = itemRow.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('input', generateInvoice);
            });
        };

        window.removeInvoiceItem = function(button) {
            button.parentElement.remove();
            generateInvoice();
        };

        window.generateInvoice = function() {
            const invoiceNumber = document.getElementById('invoiceNumber').value;
            const invoiceDate = new Date(document.getElementById('invoiceDate').value);
            const formattedDate = invoiceDate.toLocaleDateString('en-GB');
            
            const shipperName = document.getElementById('shipperName').value;
            const shipperId = document.getElementById('shipperID').value;
            
            const consigneeName = document.getElementById('consigneeName').value;
            const consigneeAddress = document.getElementById('consigneeAddress').value;
            const consigneePhone = document.getElementById('consigneePhone').value;
            
            const deliveryTerms = document.getElementById('deliveryTerms').value;
            const originCountry = document.getElementById('originCountry').value;
            const destinationCountry = document.getElementById('destinationCountry').value;
            const shippingMethod = document.getElementById('shippingMethod').value;
            const weight = document.getElementById('invoiceWeight').value;
            
            // Process items
            let itemsHTML = '';
            let totalAmount = 0;
            const itemRows = document.querySelectorAll('#invoiceItemsContainer .item-row');
            
            itemRows.forEach((row, index) => {
                const desc = row.querySelector('.item-desc').value;
                const hscode = row.querySelector('.item-hscode').value;
                const qty = parseFloat(row.querySelector('.item-qty').value) || 0;
                const rate = parseFloat(row.querySelector('.item-rate').value) || 0;
                const amount = qty * rate;
                totalAmount += amount;
                
                itemsHTML += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${desc}</td>
                        <td>${hscode}</td>
                        <td>${qty.toFixed(3)}</td>
                        <td>${rate.toFixed(2)}</td>
                        <td>${amount.toFixed(2)}</td>
                    </tr>
                `;
            });
            
            // Convert total amount to words
            const amountInWords = numberToWords(totalAmount) + ' Only';
            
            // Generate invoice HTML
            const invoiceHTML = `
                <div class="invoice-header">
                    <div>
                        <strong>SHIPPER:</strong><br>
                        ${shipperName}<br>
                        Aadhaar Number: ${shipperId}
                    </div>
                    <div>
                        <strong>INVOICE NO:</strong> ${invoiceNumber}<br>
                        <strong>DATE:</strong> ${formattedDate}<br>
                        <strong>EXPORTER'S REF:</strong> ARI - GUNTUR
                    </div>
                </div>
                
                <div class="invoice-title">INVOICE</div>
                
                <div>
                    <strong>TERM OF DELIVERY AND PAYMENTS:</strong><br>
                    ${deliveryTerms}
                </div>
                
                <div style="display: flex; justify-content: space-between; margin-top: 20px; gap: 20px;">
                    <div style="flex: 1;">
                        <strong>CONSIGNEE:</strong><br>
                        ${consigneeName}<br>
                        ${consigneeAddress.replace(/\n/g, '<br>')}<br>
                        Phone: ${consigneePhone}
                    </div>
                    <div style="flex: 1;">
                        <strong>FINAL DESTINATION:</strong> ${destinationCountry}<br>
                        <strong>OTHER REFERENCE(S):</strong> FDX<br>
                        <strong>COUNTRY OF ORIGIN:</strong> ${originCountry}<br>
                        <strong>COUNTRY OF DESTINATION:</strong> ${destinationCountry}
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <strong>SHIPPING DETAILS:</strong><br>
                    PRE-CARRIAGE BY: ${shippingMethod}<br>
                    VESSEL/FLIGHT NO.: <br>
                    PLACE OF LOADING: ${originCountry}<br>
                    PORT OF DISCHARGE: ${destinationCountry}<br>
                    PORT OF RECEIPT BY PRE CAR: GUNTUR<br>
                    WEIGHT: ${weight}
                </div>
                
                <table class="invoice-table">
                    <thead>
                        <tr>
                            <th>SR NO</th>
                            <th>DESCRIPTION OF GOODS</th>
                            <th>HS CODE</th>
                            <th>QTY</th>
                            <th>RATE</th>
                            <th>AMT</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${itemsHTML}
                    </tbody>
                </table>
                
                <div class="invoice-total">
                    <div>TOTAL = ${totalAmount.toFixed(2)}</div>
                    <div>AMOUNT IN WORDS: INR ${amountInWords}</div>
                </div>
                
                <div style="margin-top: 50px; text-align: right;">
                    <div>This is system generated invoice does not require signature.</div>
                    <div style="margin-top: 30px;"><strong>AUTHORIZED SIGNATORY</strong></div>
                </div>
            `;
            
            document.getElementById('invoicePreview').innerHTML = invoiceHTML;
        };

        // Number to words conversion function
        function numberToWords(num) {
            const single = ['', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine'];
            const double = ['Ten', 'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen', 'Sixteen', 'Seventeen', 'Eighteen', 'Nineteen'];
            const tens = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];
            
            let str = '';
            let rupees = Math.floor(num);
            let paise = Math.round((num - rupees) * 100);
            
            if (rupees > 0) {
                str += convertToWords(rupees) + ' Rupees';
            }
            
            if (paise > 0) {
                if (rupees > 0) str += ' and ';
                str += convertToWords(paise) + ' Paise';
            }
            
            return str || 'Zero Rupees';
        }

        function convertToWords(num) {
            if (num === 0) return '';
            if (num < 10) return ['', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine'][num];
            if (num < 20) return ['Ten', 'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen', 'Sixteen', 'Seventeen', 'Eighteen', 'Nineteen'][num - 10];
            if (num < 100) {
                const tens = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];
                return tens[Math.floor(num / 10)] + (num % 10 ? ' ' + convertToWords(num % 10) : '');
            }
            if (num < 1000) {
                return convertToWords(Math.floor(num / 100)) + ' Hundred' + (num % 100 ? ' ' + convertToWords(num % 100) : '');
            }
            if (num < 100000) {
                return convertToWords(Math.floor(num / 1000)) + ' Thousand' + (num % 1000 ? ' ' + convertToWords(num % 1000) : '');
            }
            return num.toString(); // Fallback for larger numbers
        }

        window.printInvoice = function() {
            window.print();
        };

        window.downloadInvoice = function() {
            showAlert('PDF download feature would be implemented here', 'info');
        };

        // Event listeners for form inputs in invoice
        document.querySelectorAll('#invoice-section input, #invoice-section textarea, #invoice-section select').forEach(input => {
            input.addEventListener('input', generateInvoice);
        });

        // Initialize the application
        checkAuth();
    </script>
</body>
</html>
